@page "/Retailers"

@model SimpleDataManagementSystem.Frontend.Web.Razor.Pages.Retailers.RetailersModel

@using SimpleDataManagementSystem.Frontend.Web.Razor.Pages.ViewComponents
@using SimpleDataManagementSystem.Frontend.Web.Razor.ViewModels.Read
@using SimpleDataManagementSystem.Frontend.Web.Razor.ViewModels.Write
@using System.Security.Claims
@using SimpleDataManagementSystem.Shared.Common.Constants

@{
    ViewData["Title"] = "Retailers";
}

<div class="header">
    <h1>Retailers</h1>
</div>


<br>

<div class="menu">
    <div>
        @if (
            PermissionsHelper.IsInRole
            (
                Roles.Admin,
                User.Claims?.Where(x => x.Type == ClaimTypes.Role)?.FirstOrDefault()?.Value!
            )
            ||
            PermissionsHelper.IsInRole
            (
                Roles.Employee,
                User.Claims?.Where(x => x.Type == ClaimTypes.Role)?.FirstOrDefault()?.Value!
            )
        )
        {
            <a href="/Retailers/Create"><button class="button-default" type="button">Create</button></a>
        }
    </div>

    @* <div class="spacer">
    </div> *@

    @* <div style="display: flex; flex-direction: row;">
    <form method="get" asp-page="/Items/Search">
    <input name="searchQuery"
    style="outline: none; flex-grow: 2; border: none; border-bottom: 1px solid gainsboro;" />
    <button type="submit" style="border: none; border-bottom: 1px solid gainsboro; background-color: white;">
    <i class="fa-solid fa-magnifying-glass"></i>
    </button>
    </form>
    </div> *@
</div>


<br>

<div class="table-default">
    <table style="table-layout: fixed; width: 100%;">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Priority</th>
                <th>Logo</th>
                @if (
                    PermissionsHelper.IsInRole
                    (
                        Roles.Admin,
                        User.Claims?.Where(x => x.Type == ClaimTypes.Role)?.FirstOrDefault()?.Value!
                    )
                    ||
                    PermissionsHelper.IsInRole
                    (
                        Roles.Employee,
                        User.Claims?.Where(x => x.Type == ClaimTypes.Role)?.FirstOrDefault()?.Value!
                    )
                )
                {
                    <th>Management</th>
                }
            </tr>
        </thead>
        <tbody>
            @if (Model?.Model?.Retailers != null)
            {
                @foreach (var r in Model.Model.Retailers)
                {
                    <tr style="max-height: 70px; height:70px;">
                        <td>@r.ID</td>
                        <td>@r.Name</td>
                        <td>@r.Priority</td>
                        <td>
                            <img width="64" height="64"
                                 src="@(r.LogoImageUri != null ? r.LogoImageUri : "/resources/image_not_available.png")" 
                            />
                        </td>
                        @if (
                            PermissionsHelper.IsInRole
                            (
                                Roles.Admin,
                                User.Claims?.Where(x => x.Type == ClaimTypes.Role)?.FirstOrDefault()?.Value!
                            )
                            ||
                            PermissionsHelper.IsInRole
                            (
                                Roles.Employee,
                                User.Claims?.Where(x => x.Type == ClaimTypes.Role)?.FirstOrDefault()?.Value!
                            )
                        )
                        {
                            <td class="options">
                                <a href="/Retailers/@r.ID)/Details">
                                    <i class="fa-solid fa-circle-info"></i>
                                </a>
                                <span>&nbsp;</span>
                                <span>&nbsp;</span>
                                <a href="/Retailers/@r.ID/Edit">
                                    <i class="fa-solid fa-pen"></i>
                                </a>
                                <span>&nbsp;</span>
                                <span>&nbsp;</span>
                                <a href="/Retailers/@r.ID/Delete">
                                    <i class="fa-solid fa-trash"></i>
                                </a>
                            </td>
                        }
                    </tr>
                }
            }
        </tbody>
    </table>

    @if (Model?.Model?.Retailers?.Count == 0)
    {
        <div class="no-data">
            No data to show.
        </div>
    }

</div>

<!-- #region Pagination -->
@await Component.InvokeAsync(typeof(PagerViewComponent), Model?.Model?.PageInfo)
<!-- #endregion Pagination -->
