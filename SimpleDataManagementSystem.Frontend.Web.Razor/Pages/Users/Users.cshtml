@page "/Users"

@model UsersModel

@using SimpleDataManagementSystem.Frontend.Web.Razor.Helpers
@using SimpleDataManagementSystem.Frontend.Web.Razor.Pages.ViewComponents
@using System.Security.Claims
@using SimpleDataManagementSystem.Shared.Common.Constants

@using Microsoft.Extensions.Localization
@inject IStringLocalizer<UsersModel> loc

@{
    ViewData["Title"] = loc["Users"];
}


<div class="header">
    <h1>@loc["Users"]</h1>
</div>

<br>

<div class="menu">
    <div>
        @if (
                PermissionsHelper.IsInRole
                (
                    Roles.Admin,
                    User.Claims?.Where(x => x.Type == ClaimTypes.Role)?.FirstOrDefault()?.Value!
                )
        )
        {
            <a href="/Users/Create"><button class="button-default" type="button">@loc["Create"]</button></a>
        }
    </div>

    <div class="spacer">
    </div>

    @* <div style="display: flex; flex-direction: row;">
        <input style="outline: none; flex-grow: 2; border: none; border-bottom: 1px solid gainsboro;" />
        <button type="button" style="border: none; border-bottom: 1px solid gainsboro; background-color: white;">
            <i class="fa-solid fa-magnifying-glass"></i>
        </button>
    </div> *@
</div>

<br />

<div class="table-default">
    <table style="table-layout: fixed; width: 100%;">
        <thead>
            <tr>
                <th>ID</th>
                <th>@loc["Username"]</th>
                <th>@loc["Role name"]</th>
                <th>@loc["Password change required"]</th>
                @if (
                        PermissionsHelper.IsInRole
                        (
                            Roles.Admin,
                            User.Claims?.Where(x => x.Type == ClaimTypes.Role)?.FirstOrDefault()?.Value!
                        )
                )
                {
                    <th>@loc["Management"]</th>
                }
            </tr>
        </thead>
        <tbody>
            @if (Model.Model.Users != null)
            {
                @foreach (var u in Model!.Model!.Users)
                {
                    <tr style="max-height: 70px; height:70px;">
                        <td>@u.Id</td>
                        <td>@u.Username</td>
                        <td>@u.Role.Name</td>
                        <td class="@(u.IsPasswordChangeRequired ? "text-danger" : "")">
                            @(u.IsPasswordChangeRequired ? loc["Yes"] : loc["No"])
                        </td>
                        @if (
                                PermissionsHelper.IsInRole(
                                    Roles.Admin,
                                    User.Claims?.Where(x => x.Type == ClaimTypes.Role)?.FirstOrDefault()?.Value!
                            )
                        )
                        {
                            <td class="options">
                                <a href="/Users/@(u.Id)/Details" title="@loc["Details"]">
                                    <i class="fa-solid fa-circle-info"></i>
                                </a>
                                <span>&nbsp;</span>
                                <span>&nbsp;</span>
                                <a href="/Users/@(u.Id)/Edit" title="@loc["Edit"]">
                                    <i class="fa-solid fa-pen"></i>
                                </a>
                                <span>&nbsp;</span>
                                <span>&nbsp;</span>
                                <a href="/Users/@(u.Id)/Delete" title="@loc["Delete"]">
                                    <i class="fa-solid fa-trash"></i>
                                </a>
                            </td>
                        }
                    </tr>
                }
            }
        </tbody>
    </table>

    @if ((Model == null) || (Model?.Model?.Users?.Count == 0) || (Model?.Model == null))
    {
        <div class="no-data">
            @loc["No data to show."]
        </div>
    }
</div>


<!-- #region Pagination -->
@await Component.InvokeAsync(typeof(PagerViewComponent), Model?.Model?.PageInfo)
<!-- #endregion Pagination -->

